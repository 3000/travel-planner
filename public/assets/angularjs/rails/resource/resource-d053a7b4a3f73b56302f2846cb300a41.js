!function(t){angular.module("rails").factory("railsRootWrapper",function(){return{wrap:function(t,e){var r={};return r[angular.isArray(t)?e.config.pluralName:e.config.name]=t,r},unwrap:function(t,e){return t.data&&t.data.hasOwnProperty(e.config.name)?t.data=t.data[e.config.name]:t.data&&t.data.hasOwnProperty(e.config.pluralName)&&(t.data=t.data[e.config.pluralName]),t}}}),angular.module("rails").provider("RailsResource",function(){var e={rootWrapping:!0,updateMethod:"put",httpConfig:{},defaultParams:t,underscoreParams:!0,fullResponse:!1,extensions:[]};this.rootWrapping=function(t){return e.rootWrapping=t,this},this.updateMethod=function(t){return e.updateMethod=t,this},this.httpConfig=function(t){return e.httpConfig=t,this},this.defaultParams=function(t){return e.defaultParams=t,this},this.underscoreParams=function(t){return e.underscoreParams=t,this},this.fullResponse=function(t){return e.fullResponse=t,this},this.extensions=function(){return e.extensions=[],angular.forEach(arguments,function(t){e.extensions=e.extensions.concat(t)}),this},this.$get=["$http","$q","railsUrlBuilder","railsSerializer","railsRootWrapper","RailsResourceInjector",function(t,r,n,i,o,s){function u(t){if(t){var e=this.constructor.deserialize({data:t});this.constructor.config.rootWrapping&&(e=o.unwrap(e,this.constructor)),angular.extend(this,e.data)}}function a(t,e){return e&&("/"!==e[0]&&(t+="/"),t+=e),t}function c(t,e){for(var r,n=0,i=t.length;i>n;n++)r=t[n],angular.isString(r)&&(r=t[n]=s.getDependency(r)),e(r)}function f(t,e,r,n){var i=["included","extended,","configure"];t.$mixins||(t.$mixins=[]),angular.isString(r)&&(r=s.getDependency(r)),r&&-1===t.$mixins.indexOf(r)&&(angular.forEach(r,function(t,r){-1===i.indexOf(r)&&(e[r]=t)}),t.$mixins.push(r),angular.isFunction(n)&&n(t,r))}function p(t){var e=[];return angular.forEach(t,function(t){t="RailsResource"+t.charAt(0).toUpperCase()+t.slice(1)+"Mixin",e.push(s.getDependency(t))}),e}function h(t,e){return angular.isUndefined(t)?e:t}function l(t,e,r){return function(n){return(t||angular.identity)(n,e,r)}}function g(t,e,n){return function(i){return t?t(i,e,n):r.reject(i)}}return u.extendTo=function(t){function e(){this.constructor=t}return angular.forEach(this,function(e,r){t[r]=e}),angular.isArray(this.$modules)&&(t.$modules=this.$modules.slice(0)),e.prototype=this.prototype,t.prototype=new e,t.__super__=this.prototype,t},u.extend=function(){return angular.forEach(arguments,function(t){f(this,this,t,function(t,e){angular.isFunction(e.extended)&&e.extended(t)})},this),this},u.include=function(){return angular.forEach(arguments,function(t){f(this,this.prototype,t,function(t,e){angular.isFunction(e.included)&&e.included(t)})},this),this},u.configure=function(t){t=t||{},this.config&&(t=angular.extend({},this.config,t)),this.config={},this.config.url=t.url,this.config.rootWrapping=h(t.rootWrapping,e.rootWrapping),this.config.httpConfig=t.httpConfig||e.httpConfig,this.config.httpConfig.headers=angular.extend({Accept:"application/json","Content-Type":"application/json"},this.config.httpConfig.headers||{}),this.config.defaultParams=t.defaultParams||e.defaultParams,this.config.underscoreParams=h(t.underscoreParams,e.underscoreParams),this.config.updateMethod=(t.updateMethod||e.updateMethod).toLowerCase(),this.config.fullResponse=h(t.fullResponse,e.fullResponse),this.config.requestTransformers=t.requestTransformers?t.requestTransformers.slice(0):[],this.config.responseInterceptors=t.responseInterceptors?t.responseInterceptors.slice(0):[],this.config.afterResponseInterceptors=t.afterResponseInterceptors?t.afterResponseInterceptors.slice(0):[],this.config.interceptors=t.interceptors?t.interceptors.slice(0):[],this.config.serializer=s.getService(t.serializer||i()),this.config.name=this.config.serializer.underscore(t.name),this.config.name&&(this.config.pluralName=this.config.serializer.underscore(t.pluralName||this.config.serializer.pluralize(this.config.name))),this.config.urlBuilder=n(this.config.url),this.config.resourceConstructor=this,this.extend.apply(this,p((t.extensions||[]).concat(e.extensions))),angular.forEach(this.$mixins,function(e){angular.isFunction(e.configure)&&e.configure(this.config,t)},this)},u.setUrl=function(t){this.configure({url:t})},u.buildUrl=function(t){return this.config.urlBuilder(t)},u.addInterceptor=function(t){this.config.interceptors.push(t)},u.intercept=function(t,e){var r={};e=s.getDependency(e),r[t]=function(t,r,n){return e(t,r,n)||t},this.addInterceptor(r)},u.interceptBeforeRequest=function(t){this.intercept("beforeRequest",t)},u.interceptBeforeRequestWrapping=function(t){this.intercept("beforeRequestWrapping",t)},u.interceptRequest=function(t){this.intercept("request",t)},u.interceptBeforeResponse=function(t){this.intercept("beforeResponse",t)},u.interceptBeforeResponseDeserialize=function(t){this.intercept("beforeResponseDeserialize",t)},u.interceptResponse=function(t){this.intercept("response",t)},u.interceptAfterResponse=function(t){this.intercept("afterResponse",t)},u.beforeResponse=function(t){t=s.getDependency(t),this.interceptResponse(function(e,r,n){return t(e.data,r.config.resourceConstructor,n),e})},u.afterResponse=function(t){t=s.getDependency(t),this.interceptAfterResponse(function(e,r,n){return t(e,r.config.resourceConstructor,n),e})},u.beforeRequest=function(t){t=s.getDependency(t),this.interceptBeforeRequestWrapping(function(e,r){return e.data=t(e.data,r.config.resourceConstructor)||e.data,e})},u.serialize=function(t){return t.data&&(t.data=this.config.serializer.serialize(t.data)),t},u.deserialize=function(t){return t.data=this.config.serializer.deserialize(t.data,this.config.resourceConstructor),t},u.callResponseInterceptors=function(t,e){var r=this.config;return c(r.responseInterceptors,function(n){t.resource=r.resourceConstructor,t.context=e,t=n(t)}),t},u.callAfterResponseInterceptors=function(t){var e=this.config;return c(e.afterResponseInterceptors,function(r){t.resource=e.resourceConstructor,t=r(t)}),t},u.runInterceptorPhase=function(t,e,r){var n=this.config,i=[];for(c(n.interceptors,function(e){(e[t]||e[t+"Error"])&&i.push(e[t],e[t+"Error"])});i.length;){var o=i.shift(),s=i.shift();r=r.then(l(o,n.resourceConstructor,e),g(s,n.resourceConstructor,e))}return r},u.$http=function(e,n,i){var s=angular.extend(angular.copy(this.config),i||{}),u=s.resourceConstructor,a=r.when(e);return a=this.runInterceptorPhase("beforeRequest",n,a).then(function(t){return t=u.serialize(t),c(s.requestTransformers,function(e){t.data=e(t.data,s.resourceConstructor)}),t}),a=this.runInterceptorPhase("beforeRequestWrapping",n,a),s.rootWrapping&&(a=a.then(function(t){return t.data=o.wrap(t.data,s.resourceConstructor),t})),a=this.runInterceptorPhase("request",n,a).then(function(e){return t(e)}),a=this.runInterceptorPhase("beforeResponse",n,a),a=this.runInterceptorPhase("beforeResponse",n,a).then(function(t){return t.originalData=t.data,t}),s.rootWrapping&&(a=a.then(function(t){return o.unwrap(t,s.resourceConstructor)})),a=this.runInterceptorPhase("beforeResponseDeserialize",n,a).then(function(t){return u.deserialize(t)}),a=this.callResponseInterceptors(a,n),a=this.runInterceptorPhase("response",n,a).then(function(t){return n&&t.hasOwnProperty("data")&&angular.isObject(t.data)&&angular.extend(n,t.data),s.fullResponse?t:n||t.data}),a=this.callAfterResponseInterceptors(a,n),a=this.runInterceptorPhase("afterResponse",n,a),a.resource=s.resourceConstructor,a.context=n,a},u.processParameters=function(t){var e={};return angular.isObject(t)&&this.config.underscoreParams?(angular.forEach(t,function(t,r){e[this.config.serializer.underscore(r)]=t},this),e):t},u.getParameters=function(t){var e;return this.config.defaultParams&&(e=angular.copy(this.config.defaultParams)),angular.isObject(t)&&(e=angular.extend(e||{},t)),this.processParameters(e)},u.getHttpConfig=function(t){var e=this.getParameters(t);return e?angular.extend({params:e},this.config.httpConfig):angular.copy(this.config.httpConfig)},u.$url=u.resourceUrl=function(t,e){return angular.isObject(t)||(t={id:t}),a(this.buildUrl(t||{}),e)},u.$get=function(t,e){return this.$http(angular.extend({method:"get",url:t},this.getHttpConfig(e)))},u.query=function(t,e){return this.$get(this.resourceUrl(e),t)},u.get=function(t,e){return this.$get(this.resourceUrl(t),e)},u.prototype.$url=function(t){return a(this.constructor.resourceUrl(this),t)},u.prototype.$http=function(t,e){return this.constructor.$http(t,this,e)},angular.forEach(["post","put","patch"],function(t){u["$"+t]=function(e,r){return r=angular.copy(r),this.$http(angular.extend({method:t,url:e,data:r},this.getHttpConfig()))},u.prototype["$"+t]=function(e){var r=angular.copy(this,{});return this.constructor.$http(angular.extend({method:t,url:e,data:r},this.constructor.getHttpConfig()),this)}}),u.prototype.create=function(){return this.$post(this.$url(),this)},u.prototype.update=function(){return this["$"+this.constructor.config.updateMethod](this.$url(),this)},u.prototype.isNew=function(){return angular.isUndefined(this.id)||null===this.id},u.prototype.save=function(){return this.isNew()?this.create():this.update()},u.$delete=function(t,e){return this.$http(angular.extend({method:"delete",url:t},this.getHttpConfig(e)))},u.prototype.$delete=function(t,e){return this.constructor.$http(angular.extend({method:"delete",url:t},this.constructor.getHttpConfig(e)),this)},u.prototype.remove=u.prototype["delete"]=function(){return this.$delete(this.$url())},u}]}),angular.module("rails").factory("railsResourceFactory",["RailsResource",function(t){return function(e){function r(){r.__super__.constructor.apply(this,arguments)}return t.extendTo(r),r.configure(e),r}}])}();